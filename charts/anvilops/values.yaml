# Default values for anvilops.
# This is a YAML-formatted file.

anvilops:
  replicaCount: 1

  image: registry.anvil.rcac.purdue.edu/anvilops/anvilops:latest
  dbMigrateImage: registry.anvil.rcac.purdue.edu/anvilops/migrate-db:latest
  imagePullPolicy: IfNotPresent

  env:
    baseURL: http://anvilops.minikube.local
    appDomain: http://minikube.local
    harborProjectName: anvilops
    harborChartRepoName: anvilops-chart
    allowedIdps: https://idp.purdue.edu/idp/shibboleth
    loginType: shibboleth
    fileBrowserImage: registry.anvil.rcac.purdue.edu/anvilops/file-browser:latest
    dockerfileBuilderImage: registry.anvil.rcac.purdue.edu/anvilops/dockerfile-builder:latest
    railpackBuilderImage: registry.anvil.rcac.purdue.edu/anvilops/railpack-builder:latest
    helmDeployerImage: registry.anvil.rcac.purdue.edu/anvilops/helm-deployer:latest
    logShipperImage: registry.anvil.rcac.purdue.edu/anvilops/log-shipper:latest
    allowHelmDeployments: false

  # This is for the secrets for pulling an image from a private repository more information can be found here: https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/
  imagePullSecrets: []

  # This is to override the chart name.
  nameOverride: ""
  fullnameOverride: ""

  securityContext:
    capabilities:
      drop: [ALL]
    runAsNonRoot: true
    runAsUser: 65532
    runAsGroup: 65532
    readOnlyRootFilesystem: true
    allowPrivilegeEscalation: false

  # This section builds out the service account more information can be found here: https://kubernetes.io/docs/concepts/security/service-accounts/
  serviceAccount:
    # Specifies whether a service account should be created
    create: true
    # Annotations to add to the service account
    annotations: {}
    # The name of the service account to use.
    # If not set and create is true, a name is generated using the fullname template
    name: ""

  # This is for setting up a service more information can be found here: https://kubernetes.io/docs/concepts/services-networking/service/
  service:
    # This sets the service type more information can be found here: https://kubernetes.io/docs/concepts/services-networking/service/#publishing-services-service-types
    type: ClusterIP
    port: 80

  # This block is for setting up the ingress for more information can be found here: https://kubernetes.io/docs/concepts/services-networking/ingress/
  ingress:
    enabled: true
    className: ""
    annotations:
      # kubernetes.io/ingress.class: nginx
      # kubernetes.io/tls-acme: "true"
    hosts:
      - host: anvilops.minikube.local
        paths:
          - path: /
            pathType: Prefix
    tls: []
    #  - secretName: chart-example-tls
    #    hosts:
    #      - chart-example.local

  resources:
    requests:
      cpu: 512m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 1Gi

  nodeSelector: {}

  tolerations: []

  affinity: {}

  apps:
    ingress:
      className: nginx
      annotations:
      # kubernetes.io/ingress.class: nginx
      # kubernetes.io/tls-acme: "true"
    netpol:
      createIngressNetworkPolicy: false
      allowedIngressMatchLabels:
        - kubernetes.io/metadata.name: kube-system
        - kubernetes.io/metadata.name: ingress-nginx

postgres:
  generateCredentials: true
  image: postgres:17
  nodeSelector: {}
  tolerations: []
  affinity: {}
  volumeClaimTemplate:
    accessModes: ["ReadWriteOnce"]
    storageClassName: standard
    resources:
      requests:
        storage: 1Gi

buildkitd:
  # Set this to `true` to install the BuildKit daemon in the cluster.
  # This is required, but if you already have it installed, you should set this to `false`.
  install: true
  address: "tcp://buildkitd:1234"
  replicaCount: 1
  nodeSelector: {}
  tolerations: []
  affinity: {}
  # Enable this to set the `hostUsers: false` option on the `buildkitd` Deployment.
  # This remaps the root UID/GID that buildkitd expects in the container to a different UID/GID on the host,
  # which reduces the impact of container escape vulnerabilities. Without user namespaces, a container escape
  # on a privileged container (like buildkitd) would result in an attacker having root permissions on the node.
  #
  # Only enable this option if your cluster supports it.
  # Check for support: https://kubernetes.io/docs/concepts/workloads/pods/user-namespaces/#set-up-a-node-to-support-user-namespaces
  # More on motivation: https://github.com/kubernetes/enhancements/tree/217d790720c5aef09b8bd4d6ca96284a0affe6c2/keps/sig-node/127-user-namespaces#motivation
  enableUserNamespaces: false

harbor:
  # Set this to `true` to install the Harbor container image registry in the cluster.
  # This is required, but if you already have it installed, you should set this to `false`.
  install: true
  # Set Harbor options here: https://github.com/goharbor/harbor-helm/tree/main?tab=readme-ov-file#configuration
  persistence:
    enabled: true
    persistentVolumeClaim:
      registry:
        storageClass: standard
      jobservice:
        jobLog:
          storageClass: standard
      database:
        storageClass: standard
      redis:
        storageClass: standard
      trivy:
        storageClass: standard
  harborAdminPassword: ""
  existingSecretAdminPassword: harbor-admin-password
  existingSecretAdminPasswordKey: HARBOR_ADMIN_PASSWORD
  logLevel: debug
  expose:
    type: ingress
    tls:
      enabled: false # Only disable this when the Ingress controller will terminate TLS for you
    ingress:
      hosts:
        core: registry.minikube.local # <-- Even if you set `install` to `false`, make sure you set this value to the hostname of your registry.
  database:
    type: external # Tell Harbor to use our Postgres database instead of spinning up its own
    external:
      host: anvilops-postgres
      port: 5432
      username: anvilops
      existingSecret: postgres-credentials

tenants:
  storageClassName: standard
  accessModes: [ReadWriteOnce]
