# Default values for anvilops.
# This is a YAML-formatted file.

anvilops:
  replicaCount: 1

  image: registry.anvil.rcac.purdue.edu/anvilops/anvilops:latest
  imagePullPolicy: IfNotPresent

  env:
    baseURL: http://anvilops.minikube.local
    appDomain: http://minikube.local
    harborProjectName: anvilops
    allowedIdps: https://idp.purdue.edu/idp/shibboleth
    fileBrowserImage: registry.anvil.rcac.purdue.edu/anvilops/file-browser:latest
    dockerfileBuilderImage: registry.anvil.rcac.purdue.edu/anvilops/dockerfile-builder:latest
    railpackBuilderImage: registry.anvil.rcac.purdue.edu/anvilops/railpack-builder:latest

  # This is for the secrets for pulling an image from a private repository more information can be found here: https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/
  imagePullSecrets: []

  # This is to override the chart name.
  nameOverride: ""
  fullnameOverride: ""

  securityContext:
    runAsUser: 1001
    runAsGroup: 1001
    runAsNonRoot: true

  # This section builds out the service account more information can be found here: https://kubernetes.io/docs/concepts/security/service-accounts/
  serviceAccount:
    # Specifies whether a service account should be created
    create: true
    # Annotations to add to the service account
    annotations: {}
    # The name of the service account to use.
    # If not set and create is true, a name is generated using the fullname template
    name: ""

  # This is for setting up a service more information can be found here: https://kubernetes.io/docs/concepts/services-networking/service/
  service:
    # This sets the service type more information can be found here: https://kubernetes.io/docs/concepts/services-networking/service/#publishing-services-service-types
    type: ClusterIP
    port: 80

  # This block is for setting up the ingress for more information can be found here: https://kubernetes.io/docs/concepts/services-networking/ingress/
  ingress:
    enabled: true
    className: ""
    annotations:
      # kubernetes.io/ingress.class: nginx
      # kubernetes.io/tls-acme: "true"
    hosts:
      - host: anvilops.minikube.local
        paths:
          - path: /
            pathType: Prefix
    tls: []
    #  - secretName: chart-example-tls
    #    hosts:
    #      - chart-example.local

  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 1Gi

  nodeSelector: {}

  tolerations: []

  affinity: {}

appProxy:
  image: registry.anvil.rcac.purdue.edu/anvilops/sandbox-proxy:latest
  service:
    type: ClusterIP
    port: 80

  ingress:
    enabled: true
    className: ""
    port: 80
    annotations:
      # kubernetes.io/ingress.class: nginx
      # kubernetes.io/tls-acme: "true"
    host: "*.minikube.local"
    tls: []

postgres:
  image: postgres:17
  nodeSelector: {}
  tolerations: []
  affinity: {}
  volumeClaimTemplate:
    accessModes: ["ReadWriteOnce"]
    storageClassName: standard
    resources:
      requests:
        storage: 1Gi

buildkitd:
  # Set this to `true` to install the BuildKit daemon in the cluster.
  # This is required, but if you already have it installed, you should set this to `false`.
  install: true
  address: "tcp://buildkitd:1234"
  replicaCount: 1
  nodeSelector: {}
  tolerations: []
  affinity: {}

harbor:
  # Set this to `true` to install the Harbor container image registry in the cluster.
  # This is required, but if you already have it installed, you should set this to `false`.
  install: true
  # Set Harbor options here: https://github.com/goharbor/harbor-helm/tree/main?tab=readme-ov-file#configuration
  persistence:
    enabled: true
    persistentVolumeClaim:
      registry:
        storageClass: standard
      jobservice:
        jobLog:
          storageClass: standard
      database:
        storageClass: standard
      redis:
        storageClass: standard
      trivy:
        storageClass: standard
  harborAdminPassword: ""
  existingSecretAdminPassword: harbor-admin-password
  existingSecretAdminPasswordKey: HARBOR_ADMIN_PASSWORD
  logLevel: debug
  expose:
    type: ingress
    tls:
      enabled: false # Only disable this when the Ingress controller will terminate TLS for you
    ingress:
      hosts:
        core: registry.minikube.local # <-- Even if you set `install` to `false`, make sure you set this value to the hostname of your registry.
  database:
    type: external # Tell Harbor to use our Postgres database instead of spinning up its own
    external:
      host: anvilops-postgres
      port: 5432
      username: anvilops
      existingSecret: postgres-credentials

logging-operator:
  # Set this to `true` to install the kube-logging operator in the cluster.
  # The operator is required, but if you already have it installed and configured with a `Logging` resource, you should set this to `false`.
  install: true
  logging:
    enabled: true # create a Logging resource, which provisions Fluentd and FluentBit to tail logs from each pod

tenants:
  storageClassName: standard
  accessModes: [ReadWriteOnce]
