# Default values for anvilops.
# This is a YAML-formatted file.

anvilops:
  replicaCount: 1
  image: registry.anvil.rcac.purdue.edu/anvilops/anvilops:0.4.0@sha256:597eea5c0e93cf5b225607a2c7123bbae6b4188259665daaf67ad6ed7bca3771
  dbMigrateImage: registry.anvil.rcac.purdue.edu/anvilops/migrate-db:0.4.0@sha256:38a47bb2e79cb5283573cad7ab4af897d12ef816f1d59fb4053c3158b8a37393
  imagePullPolicy: IfNotPresent
  env:
    baseURL: http://anvilops.minikube.local
    appDomain: http://minikube.local
    harborProjectName: anvilops
    harborChartRepoName: anvilops-chart
    allowedIdps: https://idp.purdue.edu/idp/shibboleth
    loginType: shibboleth
    fileBrowserImage: registry.anvil.rcac.purdue.edu/anvilops/file-browser:0.4.0@sha256:00e555e016be67f5ad9951b2289b162f822156d0b5b2c05bfaad552563fe5585
    dockerfileBuilderImage: registry.anvil.rcac.purdue.edu/anvilops/dockerfile-builder:0.4.0@sha256:dc33128ef0686f40dabbbd3f86312d10ff8f2b265de1fa5f8d2590182f7e1d0c
    railpackBuilderImage: registry.anvil.rcac.purdue.edu/anvilops/railpack-builder:0.4.0@sha256:f3622079f99864171ee20f37dce3afc6cad6363826e81835929fbc3c43a54481
    helmDeployerImage: registry.anvil.rcac.purdue.edu/anvilops/helm-deployer:0.4.0@sha256:4e4ccce4d3ad33721effe58a47dc06f451cd3758b854baacf89bd21258f400e8
    logShipperImage: registry.anvil.rcac.purdue.edu/anvilops/log-shipper:0.4.0@sha256:34e5660c95df243371f6ad4ed6a60901b9eec4eb53d66fea341d245bf605b471
    railpackInternalFrontendImage: registry.anvil.rcac.purdue.edu/anvilops/railpack-frontend:0.17.1@sha256:260abee6b67c17a71db43ca6d27a27036776d5b8d8da49347dc6bd8b1c85c24b
    railpackInternalBuilderImage: registry.anvil.rcac.purdue.edu/anvilops/railpack-builder:0.17.1@sha256:a98f18ce38aef3425eada7a95d7b85693075dd6afdc64f20ed74ce847c15cde5
    railpackInternalRuntimeImage: registry.anvil.rcac.purdue.edu/anvilops/railpack-runtime:0.17.1@sha256:cc2f030774f3998ae3c95eea1a1c8358e7fd8d5e4ebf6597d254576179953cd9
    allowHelmDeployments: false
    otelEndpoint: ""
    otelServiceName: anvilops
    extra:
    # If you need to add extra environment variables, put them here with the standard Kubernetes syntax. For example:
    # - name: DEBUG
    #   value: "*"
  # This is for the secrets for pulling an image from a private repository more information can be found here: https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/
  imagePullSecrets: []
  # This is to override the chart name.
  nameOverride: ""
  fullnameOverride: ""
  securityContext:
    capabilities:
      drop: [ALL]
    runAsNonRoot: true
    runAsUser: 65532
    runAsGroup: 65532
    readOnlyRootFilesystem: true
    allowPrivilegeEscalation: false
  # This section builds out the service account more information can be found here: https://kubernetes.io/docs/concepts/security/service-accounts/
  serviceAccount:
    # Specifies whether a service account should be created
    create: true
    # Annotations to add to the service account
    annotations: {}
    # The name of the service account to use.
    # If not set and create is true, a name is generated using the fullname template
    name: ""
    useKubeconfig: false
  # This is for setting up a service more information can be found here: https://kubernetes.io/docs/concepts/services-networking/service/
  service:
    # This sets the service type more information can be found here: https://kubernetes.io/docs/concepts/services-networking/service/#publishing-services-service-types
    type: ClusterIP
    port: 80
  # This block is for setting up the ingress for more information can be found here: https://kubernetes.io/docs/concepts/services-networking/ingress/
  ingress:
    enabled: true
    className: ""
    annotations:
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
    hosts:
      - host: anvilops.minikube.local
        paths:
          - path: /
            pathType: Prefix
    tls: []
    #  - secretName: chart-example-tls
    #    hosts:
    #      - chart-example.local
  resources:
    requests:
      cpu: 512m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 1Gi
  nodeSelector: {}
  tolerations: []
  affinity: {}
  apps:
    ingress:
      className: nginx
      annotations:
      # kubernetes.io/ingress.class: nginx
      # kubernetes.io/tls-acme: "true"
    netpol:
      createIngressNetworkPolicy: false
      # allowedIngressMatchLabels:
      #   - kubernetes.io/metadata.name: kube-system
      #   - kubernetes.io/metadata.name: ingress-nginx
rancher:
  enabled: false
  apiBase: ""
  refreshTokens: true
  refreshSchedule: "0 0 25 * *"
  tokenTtl: "2592000000" # 30 days
postgres:
  generateCredentials: true
  image: postgres:17
  nodeSelector: {}
  tolerations: []
  affinity: {}
  volumeClaimTemplate:
    accessModes: ["ReadWriteOnce"]
    storageClassName: standard
    resources:
      requests:
        storage: 1Gi
buildkitd:
  # Set this to `true` to install the BuildKit daemon in the cluster.
  # This is required, but if you already have it installed, you should set this to `false`.
  install: true
  address: "tcp://buildkitd:1234"
  replicaCount: 1
  nodeSelector: {}
  tolerations: []
  affinity: {}
  # Enable this to set the `hostUsers: false` option on the `buildkitd` Deployment.
  # This remaps the root UID/GID that buildkitd expects in the container to a different UID/GID on the host,
  # which reduces the impact of container escape vulnerabilities. Without user namespaces, a container escape
  # on a privileged container (like buildkitd) would result in an attacker having root permissions on the node.
  #
  # Only enable this option if your cluster supports it.
  # Check for support: https://kubernetes.io/docs/concepts/workloads/pods/user-namespaces/#set-up-a-node-to-support-user-namespaces
  # More on motivation: https://github.com/kubernetes/enhancements/tree/217d790720c5aef09b8bd4d6ca96284a0affe6c2/keps/sig-node/127-user-namespaces#motivation
  enableUserNamespaces: false
harbor:
  # Set this to `true` to install the Harbor container image registry in the cluster.
  # This is required, but if you already have it installed, you should set this to `false`.
  install: true
  # Set Harbor options here: https://github.com/goharbor/harbor-helm/tree/main?tab=readme-ov-file#configuration
  persistence:
    enabled: true
    persistentVolumeClaim:
      registry:
        storageClass: standard
      jobservice:
        jobLog:
          storageClass: standard
      database:
        storageClass: standard
      redis:
        storageClass: standard
      trivy:
        storageClass: standard
  harborAdminPassword: ""
  existingSecretAdminPassword: harbor-admin-password
  existingSecretAdminPasswordKey: HARBOR_ADMIN_PASSWORD
  logLevel: debug
  expose:
    type: ingress
    tls:
      enabled: false # Only disable this when the Ingress controller will terminate TLS for you
    ingress:
      hosts:
        core: registry.minikube.local # <-- Even if you set `install` to `false`, make sure you set this value to the hostname of your registry.
  database:
    type: external # Tell Harbor to use our Postgres database instead of spinning up its own
    external:
      host: anvilops-postgres
      port: 5432
      username: anvilops
      existingSecret: postgres-credentials
tenants:
  storageClassName: standard
  accessModes: [ReadWriteOnce]
